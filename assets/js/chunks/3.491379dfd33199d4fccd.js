(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1064:function(e,t,a){"use strict";a.r(t);var r=a(1104),i=a(1084);for(var o in i)"default"!==o&&function(e){a.d(t,e,function(){return i[e]})}(o);a(1121);var n=a(2),l=Object(n.a)(i.default,r.a,r.b,!1,null,null,null);t.default=l.exports},1082:function(e,t,a){},1083:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(a(29)),i=o(a(77));function o(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){var e=this;return{ccc:"ddd",departName:"",addFormRules:{name:[{required:!0,validator:function(t,a,r){var i=new RegExp("^[a-zA-Z0-9一-龥]+$");if(console.log(a),a&&0!=a.length)if(i.test(a))if(a.length>20)r(new Error("部门名称不得超过20个字符"));else{var o={name:""};o.name=a,e.$http({url:"/api/depart/nameExist",method:"post",data:o}).then(function(t){e.editLoading=!1,t.data.flag?r(new Error("部门名称重复")):r()})}else r(new Error("只允许输入中文、字母、数字"));else r(new Error("请输入部门名称"))},trigger:"blur"}],parentId:[{validator:function(t,a,r){if(a&&0!=a.length){var o=e.$refs.dTable.treeData,n=!0,l=!1,d=void 0;try{for(var s,p=(0,i.default)(o);!(n=(s=p.next()).done);n=!0){var c=s.value;if(c.id==a[a.length-1]){if(c._level>5){r(new Error("部门层级不得超过6级"));break}r();break}}}catch(e){l=!0,d=e}finally{try{!n&&p.return&&p.return()}finally{if(l)throw d}}}else r()},trigger:"blur"}],description:[{max:120,message:"长度不得超过120个字符",trigger:"blur"}]},editFormRules:{name:[{required:!0,validator:function(t,a,r){var i=new RegExp("^[a-zA-Z0-9一-龥]+$");if(a&&0!=a.length)if(i.test(a))if(a==e.departName)r();else if(a.length>20)r(new Error("部门名称不得超过20个字符"));else{var o={name:""};o.name=a,e.$http({url:"/api/depart/nameExist",method:"post",data:o}).then(function(t){e.editLoading=!1,t.data.flag?r(new Error("部门名称重复")):r()})}else r(new Error("只允许输入中文、字母、数字"));else r(new Error("请输入部门名称"))},trigger:"blur"}],parentId:[{validator:function(t,a,r){console.log(a);var o=a[a.length-1];if(a&&0!=a.length&&0!=o){var n=e.$refs.dTable.treeData,l=!0,d=!1,s=void 0;try{for(var p,c=(0,i.default)(n);!(l=(p=c.next()).done);l=!0){var m=p.value;if(m.id==a[a.length-1]){if(m._level>5){r(new Error("部门层级不得超过6级"));break}if(0==e.selectedDepart.childrenIds.length&&e.selectedDepart.id!=o){r();break}if(e.selectedDepart.childrenIds.indexOf(o)>=0||e.selectedDepart.id==o){r(new Error("父级部门不可选择该部门或该部门的子部门"));break}r();break}}}catch(e){d=!0,s=e}finally{try{!l&&c.return&&c.return()}finally{if(d)throw s}}}else r()},trigger:"blur"}],description:[{max:120,message:"长度不得超过120个字符",trigger:"blur"}]},props:{value:"id",label:"name",children:"children"},departs:[],options:[],selectedOptions:[],selectedDepart:{},childrenIds:[],addFormVisible:!1,addLoading:!1,addForm:{},editFormVisible:!1,editLoading:!1,editForm:{},defaultProps:{children:"children",label:"name"},currentDepart:"",columns:[{label:"名称",prop:"name",minWidth:"300px",type:"template",template:"name"},{label:"父部门",prop:"parentName",minWidth:"100px",type:"template",template:"parentName"},{label:"描述",prop:"description",minWidth:"200px",type:"template",template:"description"},{label:"创建时间",prop:"createDate",minWidth:"150px"},{label:"操作",prop:"operation",minWidth:"200px",type:"template",template:"operation"}]}},methods:{handleChange:function(e){this.currentDepart=e},handleEdit:function(e,t){this.editFormVisible=!0,this.selectedDepart=t,this.departName=t.name,this.editForm=(0,r.default)({},t)},handleAdd:function(){this.addForm={},this.addFormVisible=!0},addSubmit:function(){var e=this;this.$refs.addForm.validate(function(t){if(t){e.addLoading=!0;var a=(0,r.default)({},e.addForm);console.log(e.addForm.parentId),e.addForm.parentId&&e.addForm.parentId.length>0?a.parentId=a.parentId[a.parentId.length-1]:a.parentId=0,e.$http({method:"post",url:"api/depart/add",data:a}).then(function(t){e.addLoading=!1,t.data.flag?e.$message({message:t.data.msg,type:"success"}):e.$message({message:t.data.msg,type:"error"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1,e.getDeparts()})}})},editSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){if(t){e.editLoading=!0;var a=(0,r.default)({},e.editForm);e.editForm.parentId&&e.editForm.parentId.length>0?a.parentId=a.parentId[a.parentId.length-1]:a.parentId=0,e.$http({url:"/api/depart/update",method:"post",data:a}).then(function(t){e.editLoading=!1,t.data.flag?e.$message({message:"编辑成功",type:"success"}):e.$message({message:"编辑失败",type:"error"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.getDeparts()})}})},handleDel:function(e,t){var a=this;1==t.id?this.$message({message:"根部门不允许删除",type:"error"}):this.$confirm("删除组织会将该组织下的人员一并删除，确认删除吗?","提示",{type:"warning",closeOnClickModal:!1}).then(function(){var e={id:""};e.id=t.id,a.$http({method:"post",url:"api/depart/delete",data:e}).then(function(e){e.data.flag?a.$message({message:"删除成功",type:"success"}):a.$message({message:e.data.msg,type:"error"}),a.getDeparts()})}).catch(function(){})},getDeparts:function(){var e=this;e.$http.post("api/depart/list").then(function(t){e.departs=t.data.depart,e.options=t.data.depart}).catch(function(e){console.log(e)})}},mounted:function(){this.getDeparts()}}},1084:function(e,t,a){"use strict";a.r(t);var r=a(1083),i=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);t.default=i.a},1104:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{"overflow-y":"hidden",height:"100%"}},[a("el-form",{staticStyle:{height:"45px"},attrs:{inline:!0}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAdd}},[e._v(e._s(e.constant.TIP.ADD)+"\n        "),a("i",{staticClass:"el-icon-plus el-icon--right"})])],1)],1),e._v(" "),a("hr"),e._v(" "),a("div",{staticClass:"d-table-wrapper"},[a("c-el-table",{ref:"dTable",attrs:{stripe:"",isFold:!1,tree:"",id:"d-table",data:e.departs,height:"100%"}},[a("c-el-table-column",{attrs:{label:"名称","min-width":"250",prop:"name",tree:"","show-overflow-tooltip":""}}),e._v(" "),a("c-el-table-column",{attrs:{label:"父部门","min-width":"150",prop:"parentName","show-overflow-tooltip":""}}),e._v(" "),a("c-el-table-column",{attrs:{label:"描述","min-width":"200",prop:"description","show-overflow-tooltip":""}}),e._v(" "),a("c-el-table-column",{attrs:{label:"创建时间","min-width":"150",prop:"createDate","show-overflow-tooltip":""}}),e._v(" "),a("c-el-table-column",{attrs:{label:"操作","min-width":"200",prop:"operation"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.constant.TIP.EDIT,placement:"top"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-edit"})])],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.constant.TIP.DELETE,placement:"top"}},[a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-delete"})])],1)]}}])})],1)],1),e._v(" "),e.editFormVisible?a("el-dialog",{attrs:{title:"编辑部门",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"父级部门",prop:"parentId"}},[a("el-cascader",{attrs:{options:e.options,props:e.props,"change-on-select":"",clearable:!0,"show-all-levels":!1,"expand-trigger":"hover"},on:{change:e.handleChange},model:{value:e.editForm.parentId,callback:function(t){e.$set(e.editForm,"parentId",t)},expression:"editForm.parentId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请添加相关描述","auto-complete":"off"},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1):e._e(),e._v(" "),e.addFormVisible?a("el-dialog",{attrs:{title:"新建部门",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"父级部门",prop:"parentId"}},[a("el-cascader",{attrs:{options:e.options,props:e.props,"change-on-select":"",clearable:!0,"show-all-levels":!1,"expand-trigger":"hover"},on:{change:e.handleChange},model:{value:e.addForm.parentId,callback:function(t){e.$set(e.addForm,"parentId",t)},expression:"addForm.parentId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请添加相关描述","auto-complete":"off"},model:{value:e.addForm.description,callback:function(t){e.$set(e.addForm,"description",t)},expression:"addForm.description"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1):e._e()],1)},i=[];a.d(t,"a",function(){return r}),a.d(t,"b",function(){return i})},1121:function(e,t,a){"use strict";var r=a(1082);a.n(r).a}}]);
//# sourceMappingURL=../../map/3.js.map